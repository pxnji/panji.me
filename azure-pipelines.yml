trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

jobs:
- job: Deploy
  displayName: 'Deploy to VPS'
  steps:
  - checkout: self

  - task: UseDotNet@2
    displayName: 'Use .NET Core sdk'
    inputs:
      packageType: 'sdk'
      version: '3.1.x'

  - task: InstallSSHKey@0
    inputs:
      knownHostsEntry: '5.161.53.191 ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDjaygGkQlNk/YGhCfgQQ9pCl7DoRVFGwID3ZQQ7WsksTFhA29rdHxvCDgFdFflvC3H7TUjZoF635KRwqenHsno5EFv3q1KkDkocV6V9bfuQrQ6hqWYRq8va4qm/V7/21IKvTPqeERRIzveU54tRwf9S3GnAO2NhjPasfjF8PqKIhYwPaSN9zy0aSKU7UnsisXN2cAIlUZxycOxPK7tk7/PhBSCpgBuqW85GeqOh2zljgb3gyk4QUtMNuAu6jCCaO1rn2ymITWz6Lu+EiSchbcs7ikrAjILzwcxpcdclJ3zg9IBfBuOrLndaDJVt2LY8PWbeL4HSsYJ9ymtwBDJoNjH'
      sshPublicKey: 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDIDjQKL+sC4/w71aS6VefyrwQEtsvG0psVDYNnsCY6gLaiNEH29DojcktP6KEvrGu8S0si6TpGkEZXNjmUox6Ad8gBapTrYOmDr7eiYKN9mK83nLxoZaDehJSpgPzGxvGbUXlvglMeHzp4mBfRlrBuhBplB9R+9gfgf839+HBU9eIaA7YxPYeTVilNSVFIDlRniFlYx0FxjaNJsDi1zBpgClovh2COoE6/OiOiQS7X0rk1lKIzogHLT4BfqS/NLnVocOcCZ75IejM9KhQ/90TaxIa/6erGUIxAWLBgsvf9QLr22ykqZjdf1YM3YZXmhun9lyCupCSfBSZfyj5UkXfEs2wa7heHEYtf6hS+xkbfOX2C9AADH1J2ghjVg+enT+jMmGL2Kxg4pfZS/byGrw9m/yCvJWrCq5UKeQBciMLI6q2HylpwftDJYnA0aa1ZRW+X3cDxa+oLxwqMLRbz59/psLgENd8Rh2h5T13SrJui2xfK8hbGyNe4B9w988uZbKNqln8GSJrQzY7umxYmd+TzU1QWUDA6BxHuA6yH71vVaE28QGSFLmPDSU0SkfzuYbFdgheNLqSqjjSPPrfLB1BJ6NpUdNNSIgH6Z99yG6hu2fteIxcIhdVLMw50SJWkgkOfaH3UOFh0BrWZuKin48gtX5wRmu5skaktcxREcEExhQ== pxnji'
      sshKeySecureFile: '-----BEGIN OPENSSH PRIVATE KEY----- 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 Y7MKeWau7O0AAAAFcHhuamkBAgMEBQY= -----END OPENSSH PRIVATE KEY-----'

  - script: |
      ssh pxnji@5.161.53.191 "sudo cd /www/wwwroot/panji.me &&
                              sudo git clone https://github.com/pxnji/panji.me.git &&
                              sudo cp -r /www/wwwroot/panji.me/panji.me/* . &&
                              sudo rm -rf /www/wwwroot/panji.me/panji.me"
    displayName: 'Run Commands on VPS'